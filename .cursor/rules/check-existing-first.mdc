---
description: Before building new features, search the codebase for existing implementations
alwaysApply: true
---

# Check Existing Codebase First

**Before implementing ANY new feature, macro, or utility, search the codebase for existing implementations.**

This is the single most common source of friction — building something that already exists.

## Mandatory Search Checklist

Before writing new code, search these locations:

1. **Macro implementations**: `src/macros/` — most functionality is here
2. **Package sources**: `packages/*/src/` — feature implementations
3. **Registries** (search for these names):
   - `typeclassRegistry` — registered typeclasses
   - `instanceRegistry` — typeclass instances
   - `standaloneExtensionRegistry` — standalone extension methods
   - `instanceMethodRegistry` — methods registered for specialization
   - `syntaxRegistry` — operator syntax mappings

## Commonly-Missed Existing Features

These exist but agents keep trying to rebuild them:

| Feature                           | Location                             | What it does                    |
| --------------------------------- | ------------------------------------ | ------------------------------- |
| `match`                           | `packages/fp/src/zero-cost/match.ts` | Exhaustive pattern matching     |
| `@operator`                       | `src/macros/operators.ts`            | Operator overloading on methods |
| `specialize()` / `inlineMethod()` | `src/macros/specialize.ts`           | Zero-cost inlining              |
| `registerExtensions()`            | `src/macros/extension.ts`            | Standalone extension methods    |
| Auto-derivation                   | `@deriving` + `summon()`             | Automatic instance synthesis    |

## Critical Signals You Missed Step 1

If the user says any of these, you failed to check existing code:

- "Don't we already have X?"
- "I swear we implemented this"
- "Isn't the whole point that Y already does this?"
- "Why do you need Z when we have W?"

**Stop. Search. Read the existing implementation before continuing.**

## When Extending Existing Macros

Before modifying any macro in `src/macros/`:

1. Read the FULL current implementation (not just the part you're changing)
2. Understand how it integrates with the transformer (`src/transforms/macro-transformer.ts`)
3. Check if there are existing extension points you should use
4. Look for related tests in `tests/` to understand expected behavior
